<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #598a43; -webkit-text-stroke: #598a43}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #c1c1c1; -webkit-text-stroke: #c1c1c1; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #b76fb3; -webkit-text-stroke: #b76fb3}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #c1c1c1; -webkit-text-stroke: #c1c1c1}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #d4d69a; -webkit-text-stroke: #d4d69a}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #42b3ff; -webkit-text-stroke: #42b3ff}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #43c0a0; -webkit-text-stroke: #43c0a0}
    span.s1 {font-kerning: none; background-color: #181818}
    span.s2 {font-kerning: none}
    span.s3 {font-kerning: none; color: #b76fb3; background-color: #181818; -webkit-text-stroke: 0px #b76fb3}
    span.s4 {font-kerning: none; color: #c1c1c1; background-color: #181818; -webkit-text-stroke: 0px #c1c1c1}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #181818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #8cd3fe; background-color: #181818; -webkit-text-stroke: 0px #8cd3fe}
    span.s7 {font-kerning: none; color: #4689cc; background-color: #181818; -webkit-text-stroke: 0px #4689cc}
    span.s8 {font-kerning: none; color: #42b3ff; background-color: #181818; -webkit-text-stroke: 0px #42b3ff}
    span.s9 {font-kerning: none; color: #cacaca; background-color: #181818; -webkit-text-stroke: 0px #cacaca}
    span.s10 {font-kerning: none; color: #d4d69a; background-color: #181818; -webkit-text-stroke: 0px #d4d69a}
    span.s11 {font-kerning: none; color: #a7c598; background-color: #181818; -webkit-text-stroke: 0px #a7c598}
    span.s12 {font-kerning: none; color: #43c0a0; background-color: #181818; -webkit-text-stroke: 0px #43c0a0}
    span.s13 {font-kerning: none; color: #6d6d6d; background-color: #181818; -webkit-text-stroke: 0px #6d6d6d}
  </style>
</head>
<body>
<p class="p1"><span class="s1">// ✅ Cleaned-up JobSummaryPage.jsx</span></p>
<p class="p1"><span class="s1">// - Saves waterVolume</span></p>
<p class="p1"><span class="s1">// - Adds productName to saved data</span></p>
<p class="p1"><span class="s1">// - Removes duplicate &lt;option&gt; render</span></p>
<p class="p1"><span class="s1">// - Ready for duplicate product rows and validations</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s3">import</span><span class="s4"> </span><span class="s1">React</span><span class="s4">, { </span><span class="s1">useEffect</span><span class="s4">, </span><span class="s1">useState</span><span class="s4"> } </span><span class="s3">from</span><span class="s4"> </span><span class="s5">'react'</span><span class="s4">;</span></p>
<p class="p3"><span class="s3">import</span><span class="s4"> { </span><span class="s1">useLocation</span><span class="s4">, </span><span class="s1">useNavigate</span><span class="s4"> } </span><span class="s3">from</span><span class="s4"> </span><span class="s5">'react-router-dom'</span><span class="s4">;</span></p>
<p class="p4"><span class="s3">import</span><span class="s4"> { </span><span class="s6">db</span><span class="s4"> } </span><span class="s3">from</span><span class="s4"> </span><span class="s1">'../firebase'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">import</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">collection</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">getDocs</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">addDoc</span><span class="s4">,</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s6">doc</span><span class="s1">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">setDoc</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">serverTimestamp</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">getDoc</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">deleteDoc</span></p>
<p class="p4"><span class="s4">} </span><span class="s3">from</span><span class="s4"> </span><span class="s1">'firebase/firestore'</span><span class="s4">;</span></p>
<p class="p4"><span class="s3">import</span><span class="s4"> </span><span class="s6">Select</span><span class="s4"> </span><span class="s3">from</span><span class="s4"> </span><span class="s1">'react-select'</span><span class="s4">;</span></p>
<p class="p4"><span class="s3">import</span><span class="s4"> </span><span class="s6">html2canvas</span><span class="s4"> </span><span class="s3">from</span><span class="s4"> </span><span class="s1">'html2canvas'</span><span class="s4">;</span></p>
<p class="p4"><span class="s3">import</span><span class="s4"> { </span><span class="s6">query</span><span class="s4">, </span><span class="s6">where</span><span class="s4"> } </span><span class="s3">from</span><span class="s4"> </span><span class="s1">'firebase/firestore'</span><span class="s4">;<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s3">import</span><span class="s4"> </span><span class="s6">ProductComboBox</span><span class="s4"> </span><span class="s3">from</span><span class="s4"> </span><span class="s1">'../components/ProductComboBox'</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s7">function</span><span class="s4"> </span><span class="s1">JobSummaryPage</span><span class="s4">() {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">navigate</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">useNavigate</span><span class="s4">();</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">location</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">useLocation</span><span class="s4">();</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">const</span><span class="s4"> {</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s6">jobType</span><span class="s4">: </span><span class="s1">initialJobType</span><span class="s4">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s8">cropYear</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">new</span><span class="s4"> </span><span class="s1">Date</span><span class="s4">().</span><span class="s1">getFullYear</span><span class="s4">(),</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">selectedFields</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> []</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span>} </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> {};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s7">const</span><span class="s4"> [</span><span class="s1">jobType</span><span class="s4">, </span><span class="s1">setJobType</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">return</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">isEditing</span><span class="s4"> </span><span class="s9">?</span><span class="s4"> </span><span class="s1">initialJobType</span><span class="s4"> </span><span class="s9">:</span><span class="s4"> </span><span class="s5">''</span><span class="s4">;</span></p>
<p class="p6"><span class="s1">});</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s7">const</span><span class="s4"> [</span><span class="s1">fields</span><span class="s4">, </span><span class="s1">setFields</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">([]);</span></p>
<p class="p7"><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">updated</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">updatedField</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s6">updated</span><span class="s1">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">parsedPolygon</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">typeof</span><span class="s4"> </span><span class="s1">updated</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'string'</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">?</span><span class="s4"> </span><span class="s8">JSON</span><span class="s4">.</span><span class="s10">parse</span><span class="s4">(</span><span class="s1">updated</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4">)</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">:</span><span class="s4"> </span><span class="s1">updated</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setFields</span><span class="s4">(</span><span class="s1">prevFields</span><span class="s4"> </span><span class="s7">=&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s1">prevFields</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">f</span><span class="s4"> </span><span class="s7">=&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">f</span><span class="s1">.</span><span class="s6">id</span><span class="s1"> </span><span class="s9">===</span><span class="s1"> </span><span class="s6">updated</span><span class="s1">.</span><span class="s6">id</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s9">?</span><span class="s4"> { </span><span class="s9">...</span><span class="s1">f</span><span class="s4">, </span><span class="s9">...</span><span class="s1">updated</span><span class="s4">, </span><span class="s1">drawnPolygon:</span><span class="s4"> </span><span class="s1">parsedPolygon</span><span class="s4"> }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s9">:</span><span class="s1"> </span><span class="s6">f</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span>)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">usedProductIds</span><span class="s4">, </span><span class="s1">setUsedProductIds</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">([]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s7">const</span><span class="s4"> [</span><span class="s1">jobDate</span><span class="s4">, </span><span class="s1">setJobDate</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">jobStatus</span><span class="s4">, </span><span class="s1">setJobStatus</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s5">'Planned'</span><span class="s4">);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">saving</span><span class="s4">, </span><span class="s1">setSaving</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">shouldGeneratePDF</span><span class="s4">, </span><span class="s1">setShouldGeneratePDF</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s8">vendor</span><span class="s4">, </span><span class="s8">setVendor</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">vendor</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">applicator</span><span class="s4">, </span><span class="s1">setApplicator</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s6">location</span><span class="s4">.</span><span class="s6">state</span><span class="s4">?.</span><span class="s6">applicator</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">vendors</span><span class="s4">, </span><span class="s1">setVendors</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">([]);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">applicators</span><span class="s4">, </span><span class="s1">setApplicators</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">([]);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">editableProducts</span><span class="s4">, </span><span class="s1">setEditableProducts</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s6">location</span><span class="s4">.</span><span class="s6">state</span><span class="s4">?.</span><span class="s6">products</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> []);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">productsList</span><span class="s4">, </span><span class="s1">setProductsList</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">([]);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">jobTypesList</span><span class="s4">, </span><span class="s1">setJobTypesList</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">([]);</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">waterVolume</span><span class="s4">, </span><span class="s1">setWaterVolume</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s8">isEditing</span><span class="s4">, </span><span class="s8">setIsEditing</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">isEditing</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> [</span><span class="s8">jobId</span><span class="s1">, </span><span class="s8">setJobId</span><span class="s1">] </span><span class="s9">=</span><span class="s1"> </span><span class="s10">useState</span><span class="s1">(</span><span class="s6">location</span><span class="s1">.</span><span class="s6">state</span><span class="s1">?.</span><span class="s6">jobId</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> </span><span class="s10">doc</span><span class="s1">(</span><span class="s10">collection</span><span class="s1">(</span><span class="s6">db</span><span class="s1">, </span><span class="s5">'jobs'</span><span class="s1">)).</span><span class="s6">id</span><span class="s1">);</span></p>
<p class="p3"><span class="s7">const</span><span class="s4"> [</span><span class="s8">notes</span><span class="s4">, </span><span class="s8">setNotes</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">notes</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p3"><span class="s7">const</span><span class="s4"> [</span><span class="s8">passes</span><span class="s4">, </span><span class="s8">setPasses</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s10">useState</span><span class="s4">(</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">passes</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s11">1</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p4"><span class="s7">const</span><span class="s4"> </span><span class="s8">baseButton</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">"inline-flex items-center px-4 py-2 rounded shadow-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-1"</span><span class="s4">;</span></p>
<p class="p4"><span class="s7">const</span><span class="s4"> </span><span class="s8">primaryBtn</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">`</span><span class="s7">${</span><span class="s6">baseButton</span><span class="s7">}</span><span class="s1"> bg-green-600 text-white hover:bg-green-700`</span><span class="s4">;</span></p>
<p class="p4"><span class="s7">const</span><span class="s4"> </span><span class="s8">blueLinkBtn</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">"text-blue-600 hover:text-blue-800 underline text-sm"</span><span class="s4">;</span></p>
<p class="p4"><span class="s7">const</span><span class="s4"> </span><span class="s8">redLinkBtn</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">"text-red-600 hover:text-red-800 underline text-sm"</span><span class="s4">; <span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s7">const</span><span class="s4"> </span><span class="s8">isLeveeJob</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">jobType</span><span class="s4">?.</span><span class="s6">name</span><span class="s4">?.</span><span class="s1">toLowerCase</span><span class="s4">().</span><span class="s1">includes</span><span class="s4">(</span><span class="s5">'levee'</span><span class="s4">) </span><span class="s9">||</span><span class="s4"> </span><span class="s6">jobType</span><span class="s4">?.</span><span class="s6">name</span><span class="s4">?.</span><span class="s1">toLowerCase</span><span class="s4">().</span><span class="s1">includes</span><span class="s4">(</span><span class="s5">'pack'</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s7">const</span><span class="s4"> </span><span class="s1">totalJobAcres</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">fields</span><span class="s4">.</span><span class="s10">reduce</span><span class="s4">((</span><span class="s6">sum</span><span class="s4">, </span><span class="s6">f</span><span class="s4">) </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">isLeveeJob</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">crop</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">crops</span><span class="s4">?.[</span><span class="s1">cropYear</span><span class="s4">]?.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Rice'</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">riceLeveeAcres</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s3">return</span><span class="s4"> </span><span class="s1">sum</span><span class="s4"> </span><span class="s9">+</span><span class="s4"> </span><span class="s10">parseFloat</span><span class="s4">(</span><span class="s1">f</span><span class="s4">.</span><span class="s1">riceLeveeAcres</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Soybeans'</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">beanLeveeAcres</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s3">return</span><span class="s4"> </span><span class="s1">sum</span><span class="s4"> </span><span class="s9">+</span><span class="s4"> </span><span class="s10">parseFloat</span><span class="s4">(</span><span class="s1">f</span><span class="s4">.</span><span class="s1">beanLeveeAcres</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">return</span><span class="s4"> </span><span class="s1">sum</span><span class="s4"> </span><span class="s9">+</span><span class="s4"> (</span><span class="s1">f</span><span class="s4">.</span><span class="s1">drawnAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">gpsAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s11">0</span><span class="s4">);</span></p>
<p class="p6"><span class="s1">}, </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p4"><span class="s7">const</span><span class="s4"> </span><span class="s8">requiresProducts</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> [</span><span class="s1">'Seeding'</span><span class="s4">, </span><span class="s1">'Spraying'</span><span class="s4">, </span><span class="s1">'Fertilizing'</span><span class="s4">].</span><span class="s10">includes</span><span class="s4">(</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">jobType</span><span class="s4">?.</span><span class="s1">parentName</span></p>
<p class="p6"><span class="s1">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s7">const</span><span class="s4"> </span><span class="s1">selectedProductType</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">jobType</span><span class="s4">?.</span><span class="s6">productType</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">;</span></p>
<p class="p3"><span class="s7">const</span><span class="s4"> </span><span class="s8">requiresWater</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">jobType</span><span class="s4">?.</span><span class="s1">parentName</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Spraying'</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">// Only set default date if not editing and date is still blank</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s9">!</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">isEditing</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s9">!</span><span class="s1">jobDate</span><span class="s4">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">today</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">new</span><span class="s4"> </span><span class="s1">Date</span><span class="s4">().</span><span class="s1">toISOString</span><span class="s4">().</span><span class="s1">split</span><span class="s4">(</span><span class="s5">'T'</span><span class="s4">)[</span><span class="s11">0</span><span class="s4">];</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setJobDate</span><span class="s4">(</span><span class="s6">today</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">, </span><span class="s1">jobDate</span><span class="s4">]);</span></p>
<p class="p7"><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s9">!</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">isEditing</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s9">!</span><span class="s1">initialJobType</span><span class="s4">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setJobType</span><span class="s4">(</span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">initialJobType</span><span class="s4">, </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">jobType</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s9">!</span><span class="s1">jobTypesList</span><span class="s4">.</span><span class="s10">some</span><span class="s4">(</span><span class="s1">j</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">j</span><span class="s4">.</span><span class="s1">name</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s1">jobType</span><span class="s4">)) {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p6"><span class="s1">}, [</span><span class="s6">jobType</span><span class="s1">]);</span></p>
<p class="p7"><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">loadUsedProducts</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">async</span><span class="s4"> () </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s9">!</span><span class="s6">jobType</span><span class="s1">) </span><span class="s3">return</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">q</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s10">query</span><span class="s1">(</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s10">collection</span><span class="s1">(</span><span class="s6">db</span><span class="s1">, </span><span class="s5">'jobs'</span><span class="s1">),</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s10">where</span><span class="s1">(</span><span class="s5">'jobType'</span><span class="s1">, </span><span class="s5">'=='</span><span class="s1">, </span><span class="s6">jobType</span><span class="s1">),</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s10">where</span><span class="s4">(</span><span class="s1">'cropYear'</span><span class="s4">, </span><span class="s1">'=='</span><span class="s4">, </span><span class="s6">cropYear</span><span class="s4">)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">snap</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s3">await</span><span class="s1"> </span><span class="s10">getDocs</span><span class="s1">(</span><span class="s6">q</span><span class="s1">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">allUsed</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s10">Set</span><span class="s1">();</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">snap</span><span class="s4">.</span><span class="s1">docs</span><span class="s4">.</span><span class="s10">forEach</span><span class="s4">(</span><span class="s1">doc</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">products</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s6">doc</span><span class="s1">.</span><span class="s10">data</span><span class="s1">().</span><span class="s6">products</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> [];</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s6">products</span><span class="s1">.</span><span class="s10">forEach</span><span class="s1">(</span><span class="s6">p</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">p</span><span class="s4">.</span><span class="s1">productId</span><span class="s4">) </span><span class="s1">allUsed</span><span class="s4">.</span><span class="s10">add</span><span class="s4">(</span><span class="s1">p</span><span class="s4">.</span><span class="s1">productId</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setUsedProductIds</span><span class="s4">(</span><span class="s6">Array</span><span class="s4">.</span><span class="s1">from</span><span class="s4">(</span><span class="s6">allUsed</span><span class="s4">));</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">loadUsedProducts</span><span class="s4">();</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">jobType</span><span class="s4">, </span><span class="s1">cropYear</span><span class="s4">]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">const</span><span class="s4"> </span><span class="s10">loadData</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">async</span><span class="s4"> () </span><span class="s1">=&gt;</span><span class="s4"> {</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> [</span><span class="s1">vendorSnap</span><span class="s4">, </span><span class="s1">applicatorSnap</span><span class="s4">, </span><span class="s1">productSnap</span><span class="s4">, </span><span class="s1">jobTypeSnap</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s3">await</span><span class="s4"> </span><span class="s12">Promise</span><span class="s4">.</span><span class="s10">all</span><span class="s4">([</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s1">getDocs</span><span class="s4">(</span><span class="s1">collection</span><span class="s4">(</span><span class="s6">db</span><span class="s4">, </span><span class="s5">'vendors'</span><span class="s4">)),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s1">getDocs</span><span class="s4">(</span><span class="s1">collection</span><span class="s4">(</span><span class="s6">db</span><span class="s4">, </span><span class="s5">'applicators'</span><span class="s4">)),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s1">getDocs</span><span class="s4">(</span><span class="s1">collection</span><span class="s4">(</span><span class="s6">db</span><span class="s4">, </span><span class="s5">'products'</span><span class="s4">)),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s1">getDocs</span><span class="s4">(</span><span class="s1">collection</span><span class="s4">(</span><span class="s6">db</span><span class="s4">, </span><span class="s5">'jobTypes'</span><span class="s4">))</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setVendors</span><span class="s4">(</span><span class="s1">vendorSnap</span><span class="s4">.</span><span class="s1">docs</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">doc</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">doc</span><span class="s4">.</span><span class="s10">data</span><span class="s4">().</span><span class="s1">name</span><span class="s4">));</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setApplicators</span><span class="s4">(</span><span class="s1">applicatorSnap</span><span class="s4">.</span><span class="s1">docs</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">doc</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">doc</span><span class="s4">.</span><span class="s10">data</span><span class="s4">().</span><span class="s1">name</span><span class="s4">));</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setProductsList</span><span class="s4">(</span><span class="s1">productSnap</span><span class="s4">.</span><span class="s1">docs</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">doc</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> ({ </span><span class="s1">id:</span><span class="s4"> </span><span class="s1">doc</span><span class="s4">.</span><span class="s1">id</span><span class="s4">, </span><span class="s9">...</span><span class="s1">doc</span><span class="s4">.</span><span class="s10">data</span><span class="s4">() })));</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">rawTypes</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">jobTypeSnap</span><span class="s4">.</span><span class="s1">docs</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">doc</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> ({ </span><span class="s1">id:</span><span class="s4"> </span><span class="s1">doc</span><span class="s4">.</span><span class="s1">id</span><span class="s4">, </span><span class="s9">...</span><span class="s1">doc</span><span class="s4">.</span><span class="s10">data</span><span class="s4">() }));</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">flattenedTypes</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">rawTypes</span><span class="s4">.</span><span class="s10">flatMap</span><span class="s4">(</span><span class="s6">type</span><span class="s4"> </span><span class="s7">=&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span>(</span><span class="s6">type</span><span class="s1">.</span><span class="s6">subTypes</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> []).</span><span class="s10">map</span><span class="s1">(</span><span class="s6">sub</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> ({</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s9">...</span><span class="s6">sub</span><span class="s1">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">parentName:</span><span class="s4"> </span><span class="s1">type</span><span class="s4">.</span><span class="s1">name</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span>}))</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setJobTypesList</span><span class="s4">(</span><span class="s6">flattenedTypes</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">initialJobType</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s10">setJobType</span><span class="s4">(</span><span class="s1">initialJobType</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">loadData</span><span class="s4">();</span></p>
<p class="p6"><span class="s1">}, []);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">const</span><span class="s4"> </span><span class="s10">loadJob</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">async</span><span class="s4"> () </span><span class="s1">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">jobId</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">jobId</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">editing</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">isEditing</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s9">!</span><span class="s1">editing</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s9">!</span><span class="s1">jobId</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setIsEditing</span><span class="s4">(</span><span class="s7">true</span><span class="s4">); </span><span class="s1">// ✅ keeps it locked in state</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">jobDoc</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s3">await</span><span class="s1"> </span><span class="s10">getDoc</span><span class="s1">(</span><span class="s10">doc</span><span class="s1">(</span><span class="s6">db</span><span class="s1">, </span><span class="s5">'jobs'</span><span class="s1">, </span><span class="s6">jobId</span><span class="s1">));</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s9">!</span><span class="s6">jobDoc</span><span class="s1">.</span><span class="s10">exists</span><span class="s1">()) </span><span class="s3">return</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">jobData</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s6">jobDoc</span><span class="s1">.</span><span class="s10">data</span><span class="s1">();</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setJobType</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">jobType</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setJobDate</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">jobDate</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setVendor</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">vendor</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setApplicator</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">applicator</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setJobStatus</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">status</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">'Planned'</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setEditableProducts</span><span class="s4">(</span><span class="s6">jobData</span><span class="s4">.</span><span class="s6">products</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> []);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setWaterVolume</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">waterVolume</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setFields</span><span class="s4">(</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>(</span><span class="s6">jobData</span><span class="s1">.</span><span class="s6">fields</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> []).</span><span class="s10">map</span><span class="s1">(</span><span class="s6">f</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> ({</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s9">...</span><span class="s6">f</span><span class="s1">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">drawnPolygon:</span><span class="s4"> </span><span class="s7">typeof</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'string'</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">?</span><span class="s4"> </span><span class="s8">JSON</span><span class="s4">.</span><span class="s10">parse</span><span class="s4">(</span><span class="s1">f</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4">)</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">:</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">drawnPolygon</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}))</span></p>
<p class="p6"><span class="s1">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setIsEditing</span><span class="s4">(</span><span class="s7">true</span><span class="s4">);</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setJobId</span><span class="s4">(</span><span class="s6">jobId</span><span class="s4">); </span><span class="s1">// keeps the ID locked</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setNotes</span><span class="s4">(</span><span class="s1">jobData</span><span class="s4">.</span><span class="s1">notes</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">loadJob</span><span class="s4">();</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">updated</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">updatedField</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s9">!</span><span class="s1">updated</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">selectedFields</span><span class="s4">?.</span><span class="s1">length</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setFields</span><span class="s4">(</span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">.</span><span class="s1">selectedFields</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">location</span><span class="s4">.</span><span class="s1">key</span><span class="s4">]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s1">useEffect</span><span class="s4">(() </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">updated</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">updatedField</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">selected</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">location</span><span class="s4">.</span><span class="s1">state</span><span class="s4">?.</span><span class="s1">selectedFields</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> [];</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s6">updated</span><span class="s1">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">parsedPolygon</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">typeof</span><span class="s4"> </span><span class="s1">updated</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'string'</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">?</span><span class="s4"> </span><span class="s8">JSON</span><span class="s4">.</span><span class="s10">parse</span><span class="s4">(</span><span class="s1">updated</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4">)</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">:</span><span class="s4"> </span><span class="s1">updated</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">alreadyIncluded</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">selected</span><span class="s4">.</span><span class="s10">some</span><span class="s4">(</span><span class="s1">f</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">id</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s1">updated</span><span class="s4">.</span><span class="s1">id</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">mergedFields</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">alreadyIncluded</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s9">?</span><span class="s1"> </span><span class="s6">selected</span><span class="s1">.</span><span class="s10">map</span><span class="s1">(</span><span class="s6">f</span><span class="s1"> </span><span class="s7">=&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s6">f</span><span class="s1">.</span><span class="s6">id</span><span class="s1"> </span><span class="s9">===</span><span class="s1"> </span><span class="s6">updated</span><span class="s1">.</span><span class="s6">id</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s9">?</span><span class="s4"> { </span><span class="s9">...</span><span class="s1">f</span><span class="s4">, </span><span class="s9">...</span><span class="s1">updated</span><span class="s4">, </span><span class="s1">drawnPolygon:</span><span class="s4"> </span><span class="s1">parsedPolygon</span><span class="s4"> }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">:</span><span class="s1"> </span><span class="s6">f</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>)</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s9">:</span><span class="s4"> [</span><span class="s9">...</span><span class="s1">selected</span><span class="s4">, { </span><span class="s9">...</span><span class="s1">updated</span><span class="s4">, </span><span class="s1">drawnPolygon:</span><span class="s4"> </span><span class="s1">parsedPolygon</span><span class="s4"> }];</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setFields</span><span class="s4">(</span><span class="s1">mergedFields</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s4"> </span><span class="s3">if</span><span class="s4"> (</span><span class="s1">selected</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setFields</span><span class="s4">(</span><span class="s6">selected</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s4">}, [</span><span class="s1">location</span><span class="s4">.</span><span class="s1">key</span><span class="s4">]);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">handleProductChange</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> (</span><span class="s6">index</span><span class="s4">, </span><span class="s6">field</span><span class="s4">, </span><span class="s6">value</span><span class="s4">) </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">updated</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> [</span><span class="s9">...</span><span class="s1">editableProducts</span><span class="s4">];</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">updated</span><span class="s4">[</span><span class="s1">index</span><span class="s4">][</span><span class="s1">field</span><span class="s4">] </span><span class="s9">=</span><span class="s4"> </span><span class="s1">value</span><span class="s4">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setEditableProducts</span><span class="s4">(</span><span class="s6">updated</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">handleAddProduct</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> () </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">setEditableProducts</span><span class="s4">(</span><span class="s1">prev</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> [</span><span class="s9">...</span><span class="s1">prev</span><span class="s4">, { </span><span class="s1">productId:</span><span class="s4"> </span><span class="s5">''</span><span class="s4">, </span><span class="s1">productName:</span><span class="s4"> </span><span class="s5">''</span><span class="s4">, </span><span class="s1">rate:</span><span class="s4"> </span><span class="s5">''</span><span class="s4">, </span><span class="s1">unit:</span><span class="s4"> </span><span class="s5">''</span><span class="s4"> }]);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s7">function</span><span class="s4"> </span><span class="s10">renderBoundarySVG</span><span class="s4">(</span><span class="s1">geometry</span><span class="s4">, </span><span class="s1">overlayRaw</span><span class="s4">) {</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s9">!</span><span class="s6">geometry</span><span class="s1">) </span><span class="s3">return</span><span class="s1"> </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">let</span><span class="s4"> </span><span class="s1">shape</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">geometry</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">geometry</span><span class="s4">.</span><span class="s1">type</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Feature'</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">geometry</span><span class="s4">.</span><span class="s1">geometry</span><span class="s4">?.</span><span class="s1">type</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Polygon'</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">shape</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">geometry</span><span class="s4">.</span><span class="s1">geometry</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">shape</span><span class="s4">.</span><span class="s1">type</span><span class="s4"> </span><span class="s9">!==</span><span class="s4"> </span><span class="s5">'Polygon'</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s9">!</span><span class="s1">shape</span><span class="s4">.</span><span class="s1">coordinates</span><span class="s4">?.[</span><span class="s11">0</span><span class="s4">]) </span><span class="s3">return</span><span class="s4"> </span><span class="s7">null</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">coords</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">shape</span><span class="s4">.</span><span class="s1">coordinates</span><span class="s4">[</span><span class="s11">0</span><span class="s4">];</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">bounds</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s6">coords</span><span class="s1">.</span><span class="s10">reduce</span><span class="s1">((</span><span class="s6">acc</span><span class="s1">, [</span><span class="s6">lng</span><span class="s1">, </span><span class="s6">lat</span><span class="s1">]) </span><span class="s7">=&gt;</span><span class="s1"> ({</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">minX:</span><span class="s4"> </span><span class="s1">Math</span><span class="s4">.</span><span class="s10">min</span><span class="s4">(</span><span class="s1">acc</span><span class="s4">.</span><span class="s1">minX</span><span class="s4">, </span><span class="s1">lng</span><span class="s4">),</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">maxX:</span><span class="s4"> </span><span class="s1">Math</span><span class="s4">.</span><span class="s10">max</span><span class="s4">(</span><span class="s1">acc</span><span class="s4">.</span><span class="s1">maxX</span><span class="s4">, </span><span class="s1">lng</span><span class="s4">),</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">minY:</span><span class="s4"> </span><span class="s1">Math</span><span class="s4">.</span><span class="s10">min</span><span class="s4">(</span><span class="s1">acc</span><span class="s4">.</span><span class="s1">minY</span><span class="s4">, </span><span class="s1">lat</span><span class="s4">),</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">maxY:</span><span class="s4"> </span><span class="s1">Math</span><span class="s4">.</span><span class="s10">max</span><span class="s4">(</span><span class="s1">acc</span><span class="s4">.</span><span class="s1">maxY</span><span class="s4">, </span><span class="s1">lat</span><span class="s4">),</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span>}), { </span><span class="s6">minX:</span><span class="s4"> </span><span class="s1">Infinity</span><span class="s4">, </span><span class="s6">maxX:</span><span class="s4"> </span><span class="s9">-</span><span class="s1">Infinity</span><span class="s4">, </span><span class="s6">minY:</span><span class="s4"> </span><span class="s1">Infinity</span><span class="s4">, </span><span class="s6">maxY:</span><span class="s4"> </span><span class="s9">-</span><span class="s1">Infinity</span><span class="s4"> });</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">width</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">bounds</span><span class="s4">.</span><span class="s1">maxX</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">bounds</span><span class="s4">.</span><span class="s1">minX</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s11">1</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">height</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">bounds</span><span class="s4">.</span><span class="s1">maxY</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">bounds</span><span class="s4">.</span><span class="s1">minY</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s11">1</span><span class="s4">;</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">boxSize</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s11">300</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">margin</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s11">10</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">scale</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> (</span><span class="s1">boxSize</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">margin</span><span class="s4"> </span><span class="s9">*</span><span class="s4"> </span><span class="s11">2</span><span class="s4">) </span><span class="s9">/</span><span class="s4"> </span><span class="s1">Math</span><span class="s4">.</span><span class="s10">max</span><span class="s4">(</span><span class="s1">width</span><span class="s4">, </span><span class="s1">height</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">xOffset</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> (</span><span class="s1">boxSize</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">width</span><span class="s4"> </span><span class="s9">*</span><span class="s4"> </span><span class="s1">scale</span><span class="s4">) </span><span class="s9">/</span><span class="s4"> </span><span class="s11">2</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">yOffset</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> (</span><span class="s1">boxSize</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">height</span><span class="s4"> </span><span class="s9">*</span><span class="s4"> </span><span class="s1">scale</span><span class="s4">) </span><span class="s9">/</span><span class="s4"> </span><span class="s11">2</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s10">project</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> ([</span><span class="s6">lng</span><span class="s1">, </span><span class="s6">lat</span><span class="s1">]) </span><span class="s7">=&gt;</span><span class="s1"> ({</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">x:</span><span class="s4"> (</span><span class="s1">lng</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">bounds</span><span class="s4">.</span><span class="s1">minX</span><span class="s4">) </span><span class="s9">*</span><span class="s4"> </span><span class="s1">scale</span><span class="s4"> </span><span class="s9">+</span><span class="s4"> </span><span class="s1">xOffset</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">y:</span><span class="s4"> </span><span class="s1">boxSize</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> ((</span><span class="s1">lat</span><span class="s4"> </span><span class="s9">-</span><span class="s4"> </span><span class="s1">bounds</span><span class="s4">.</span><span class="s1">minY</span><span class="s4">) </span><span class="s9">*</span><span class="s4"> </span><span class="s1">scale</span><span class="s4"> </span><span class="s9">+</span><span class="s4"> </span><span class="s1">yOffset</span><span class="s4">),</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">basePath</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s6">coords</span><span class="s1">.</span><span class="s10">map</span><span class="s1">((</span><span class="s6">pt</span><span class="s1">, </span><span class="s6">i</span><span class="s1">) </span><span class="s7">=&gt;</span><span class="s1"> {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> { </span><span class="s8">x</span><span class="s1">, </span><span class="s8">y</span><span class="s1"> } </span><span class="s9">=</span><span class="s1"> </span><span class="s10">project</span><span class="s1">(</span><span class="s6">pt</span><span class="s1">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">return</span><span class="s4"> </span><span class="s5">`</span><span class="s7">${</span><span class="s6">i</span><span class="s1"> === </span><span class="s11">0</span><span class="s1"> ? </span><span class="s5">'M'</span><span class="s1"> : </span><span class="s5">'L'</span><span class="s7">}${</span><span class="s6">x</span><span class="s7">}</span><span class="s5">,</span><span class="s7">${</span><span class="s6">y</span><span class="s7">}</span><span class="s5">`</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}).</span><span class="s10">join</span><span class="s1">(</span><span class="s5">' '</span><span class="s1">) </span><span class="s9">+</span><span class="s1"> </span><span class="s5">' Z'</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">let</span><span class="s4"> </span><span class="s1">overlayPath</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">null</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">overlayRaw</span><span class="s4">?.</span><span class="s1">type</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Feature'</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">overlayRaw</span><span class="s4">.</span><span class="s1">geometry</span><span class="s4">?.</span><span class="s1">type</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Polygon'</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">overlayCoords</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">overlayRaw</span><span class="s4">.</span><span class="s1">geometry</span><span class="s4">.</span><span class="s1">coordinates</span><span class="s4">?.[</span><span class="s11">0</span><span class="s4">] </span><span class="s9">||</span><span class="s4"> [];</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">overlayPath</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">overlayCoords</span><span class="s4">.</span><span class="s10">map</span><span class="s4">((</span><span class="s1">pt</span><span class="s4">, </span><span class="s1">i</span><span class="s4">) </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s7">const</span><span class="s1"> { </span><span class="s8">x</span><span class="s1">, </span><span class="s8">y</span><span class="s1"> } </span><span class="s9">=</span><span class="s1"> </span><span class="s10">project</span><span class="s1">(</span><span class="s6">pt</span><span class="s1">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s3">return</span><span class="s4"> </span><span class="s5">`</span><span class="s7">${</span><span class="s6">i</span><span class="s1"> === </span><span class="s11">0</span><span class="s1"> ? </span><span class="s5">'M'</span><span class="s1"> : </span><span class="s5">'L'</span><span class="s7">}${</span><span class="s6">x</span><span class="s7">}</span><span class="s5">,</span><span class="s7">${</span><span class="s6">y</span><span class="s7">}</span><span class="s5">`</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>}).</span><span class="s10">join</span><span class="s1">(</span><span class="s5">' '</span><span class="s1">) </span><span class="s9">+</span><span class="s1"> </span><span class="s5">' Z'</span><span class="s1">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">return</span><span class="s4"> (</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">svg</span><span class="s4"> </span><span class="s6">viewBox</span><span class="s9">=</span><span class="s7">{</span><span class="s1">`0 0 </span><span class="s7">${</span><span class="s6">boxSize</span><span class="s7">}</span><span class="s1"> </span><span class="s7">${</span><span class="s6">boxSize</span><span class="s7">}</span><span class="s1">`</span><span class="s7">}</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"w-64 h-64 bg-white border rounded shadow mx-auto"</span><span class="s13">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s7">{</span><span class="s1">/* Full field boundary = RED if overlay exists */</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;</span><span class="s7">path</span><span class="s4"> </span><span class="s1">d</span><span class="s9">=</span><span class="s7">{</span><span class="s1">basePath</span><span class="s7">}</span><span class="s4"> </span><span class="s1">fill</span><span class="s9">=</span><span class="s7">{</span><span class="s1">overlayPath</span><span class="s9"> ? </span><span class="s5">'#F87171'</span><span class="s9"> : </span><span class="s5">'#34D399'</span><span class="s7">}</span><span class="s4"> </span><span class="s1">fillOpacity</span><span class="s9">=</span><span class="s7">{</span><span class="s11">0.4</span><span class="s7">}</span><span class="s4"> </span><span class="s1">stroke</span><span class="s9">=</span><span class="s5">"#4B5563"</span><span class="s4"> </span><span class="s1">strokeWidth</span><span class="s9">=</span><span class="s5">"1.5"</span><span class="s4"> </span><span class="s13">/&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s7">{</span><span class="s1">/* Application area (polygon) = GREEN */</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s7">{</span><span class="s1">overlayPath</span><span class="s9"> &amp;&amp; (</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">path</span><span class="s9"> </span><span class="s1">d</span><span class="s9">=</span><span class="s7">{</span><span class="s1">overlayPath</span><span class="s7">}</span><span class="s9"> </span><span class="s1">fill</span><span class="s9">=</span><span class="s5">"#34D399"</span><span class="s9"> </span><span class="s1">fillOpacity</span><span class="s9">=</span><span class="s7">{</span><span class="s11">0.6</span><span class="s7">}</span><span class="s9"> </span><span class="s1">stroke</span><span class="s9">=</span><span class="s5">"#047857"</span><span class="s9"> </span><span class="s1">strokeWidth</span><span class="s9">=</span><span class="s5">"2"</span><span class="s9"> </span><span class="s13">/&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span>)</span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;/</span><span class="s7">svg</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p6"><span class="s1">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">handleSaveJob</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s7">async</span><span class="s4"> () </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">setSaving</span><span class="s4">(</span><span class="s7">true</span><span class="s4">);</span></p>
<p class="p1"><span class="s1">// use the state value instead</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s9">!</span><span class="s6">jobType</span><span class="s1">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">alert</span><span class="s4">(</span><span class="s1">'Please select a job type before saving.'</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setSaving</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">return</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">fields</span><span class="s4">.</span><span class="s1">length</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s11">0</span><span class="s4">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">alert</span><span class="s4">(</span><span class="s1">'Please add at least one field.'</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setSaving</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">return</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">requiresProducts</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">editableProducts</span><span class="s4">.</span><span class="s1">length</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s11">0</span><span class="s4">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s10">alert</span><span class="s4">(</span><span class="s1">'Please add at least one product.'</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">setSaving</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">return</span><span class="s4">;</span></p>
<p class="p6"><span class="s1">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">incompleteProduct</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">editableProducts</span><span class="s4">.</span><span class="s10">find</span><span class="s4">(</span><span class="s6">p</span><span class="s4"> </span><span class="s7">=&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s9">!</span><span class="s1">p</span><span class="s4">.</span><span class="s1">productId</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s9">!</span><span class="s1">p</span><span class="s4">.</span><span class="s1">rate</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s9">!</span><span class="s1">p</span><span class="s4">.</span><span class="s1">unit</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">incompleteProduct</span><span class="s4">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">alert</span><span class="s4">(</span><span class="s1">'Please fill out all product fields (product, rate, and unit).'</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setSaving</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">return</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space"> </span></span><span class="s3">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">updatedFields</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s3">await</span><span class="s1"> </span><span class="s12">Promise</span><span class="s1">.</span><span class="s10">all</span><span class="s1">(</span><span class="s6">fields</span><span class="s1">.</span><span class="s10">map</span><span class="s1">(</span><span class="s7">async</span><span class="s1"> (</span><span class="s6">field</span><span class="s1">) </span><span class="s7">=&gt;</span><span class="s1"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">ref</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">document</span><span class="s4">.</span><span class="s10">getElementById</span><span class="s4">(</span><span class="s5">`field-canvas-</span><span class="s7">${</span><span class="s1">field</span><span class="s9">.</span><span class="s1">id</span><span class="s7">}</span><span class="s5">`</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s9">!</span><span class="s6">ref</span><span class="s1">) </span><span class="s3">return</span><span class="s1"> </span><span class="s6">field</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">buttons</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">ref</span><span class="s4">.</span><span class="s1">querySelectorAll</span><span class="s4">(</span><span class="s5">'.no-print'</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">buttons</span><span class="s4">.</span><span class="s10">forEach</span><span class="s4">(</span><span class="s1">btn</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">btn</span><span class="s4">.</span><span class="s1">style</span><span class="s4">.</span><span class="s1">display</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s5">'none'</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">canvas</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s3">await</span><span class="s1"> </span><span class="s10">html2canvas</span><span class="s1">(</span><span class="s6">ref</span><span class="s1">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">imageBase64</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s6">canvas</span><span class="s1">.</span><span class="s10">toDataURL</span><span class="s1">(</span><span class="s5">'image/png'</span><span class="s1">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">buttons</span><span class="s4">.</span><span class="s10">forEach</span><span class="s4">(</span><span class="s1">btn</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s1">btn</span><span class="s4">.</span><span class="s1">style</span><span class="s4">.</span><span class="s1">display</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s5">''</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">return</span><span class="s4"> { </span><span class="s9">...</span><span class="s1">field</span><span class="s4">, </span><span class="s1">imageBase64</span><span class="s4"> };</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}));</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">updatedFieldsWithAcres</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">updatedFields</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s6">f</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">let</span><span class="s4"> </span><span class="s1">polygon</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">polygon</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s7">typeof</span><span class="s4"> </span><span class="s1">polygon</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'object'</span><span class="s4"> </span><span class="s9">&amp;&amp;</span><span class="s4"> </span><span class="s1">polygon</span><span class="s4">.</span><span class="s1">type</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Feature'</span><span class="s4">) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">polygon</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s8">JSON</span><span class="s4">.</span><span class="s10">stringify</span><span class="s4">(</span><span class="s1">polygon</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">return</span><span class="s4"> {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s9">...</span><span class="s6">f</span><span class="s1">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">drawnPolygon:</span><span class="s4"> </span><span class="s1">polygon</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">acres:</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">drawnAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s1">f</span><span class="s4">.</span><span class="s1">gpsAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s11">0</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">riceLeveeAcres:</span><span class="s4"> </span><span class="s1">f</span><span class="s4">?.</span><span class="s1">riceLeveeAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">beanLeveeAcres:</span><span class="s4"> </span><span class="s1">f</span><span class="s4">?.</span><span class="s1">beanLeveeAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p6"><span class="s1">});</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s7">const</span><span class="s4"> </span><span class="s8">cleanedProducts</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">editableProducts</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">p</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> ({</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">productId:</span><span class="s4"> </span><span class="s1">p</span><span class="s4">.</span><span class="s1">productId</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">productName:</span><span class="s4"> </span><span class="s1">p</span><span class="s4">.</span><span class="s1">productName</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">rate:</span><span class="s4"> </span><span class="s1">p</span><span class="s4">.</span><span class="s1">rate</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">unit:</span><span class="s4"> </span><span class="s1">p</span><span class="s4">.</span><span class="s1">unit</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">crop:</span><span class="s4"> </span><span class="s1">p</span><span class="s4">.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">rateType:</span><span class="s4"> </span><span class="s1">p</span><span class="s4">.</span><span class="s1">rateType</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span></p>
<p class="p6"><span class="s1">}));</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">masterJob</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">jobId</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">jobType:</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">name:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">.</span><span class="s1">name</span><span class="s4">,</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">icon:</span><span class="s1"> </span><span class="s8">jobType</span><span class="s1">.</span><span class="s6">icon</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> </span><span class="s5">''</span><span class="s1">,</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">cost:</span><span class="s1"> </span><span class="s8">jobType</span><span class="s1">.</span><span class="s6">cost</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> </span><span class="s11">0</span><span class="s1">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">parentName:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">.</span><span class="s1">parentName</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>},</span></p>
<p class="p6"><span class="s9">...</span><span class="s1">(</span><span class="s8">jobType</span><span class="s1">?.</span><span class="s6">parentName</span><span class="s1"> </span><span class="s9">===</span><span class="s1"> </span><span class="s5">'Tillage'</span><span class="s1"> </span><span class="s9">?</span><span class="s1"> { </span><span class="s6">passes:</span><span class="s1"> </span><span class="s10">parseInt</span><span class="s1">(</span><span class="s8">passes</span><span class="s1">) </span><span class="s9">||</span><span class="s1"> </span><span class="s11">1</span><span class="s1"> } </span><span class="s9">:</span><span class="s1"> {}),</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">vendor:</span><span class="s4"> </span><span class="s8">vendor</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">applicator:</span><span class="s4"> </span><span class="s8">applicator</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">products:</span><span class="s4"> </span><span class="s1">cleanedProducts</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">cropYear</span><span class="s4">,</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s6">jobDate:</span><span class="s1"> </span><span class="s8">jobDate</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s1">().</span><span class="s10">toISOString</span><span class="s1">().</span><span class="s10">split</span><span class="s1">(</span><span class="s5">'T'</span><span class="s1">)[</span><span class="s11">0</span><span class="s1">],</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">status:</span><span class="s4"> </span><span class="s1">jobStatus</span><span class="s4">,</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">fieldIds:</span><span class="s4"> </span><span class="s1">updatedFieldsWithAcres</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s6">f</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s6">f</span><span class="s4">.</span><span class="s6">id</span><span class="s4">),</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">waterVolume:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">?.</span><span class="s1">parentName</span><span class="s4"> </span><span class="s9">===</span><span class="s4"> </span><span class="s5">'Spraying'</span><span class="s4"> </span><span class="s9">?</span><span class="s4"> </span><span class="s8">waterVolume</span><span class="s4"> </span><span class="s9">:</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">fields:</span><span class="s4"> </span><span class="s1">updatedFieldsWithAcres</span><span class="s4">,</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">acres:</span><span class="s4"> </span><span class="s12">Object</span><span class="s4">.</span><span class="s10">fromEntries</span><span class="s4">(</span><span class="s1">updatedFieldsWithAcres</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s6">f</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> [</span><span class="s6">f</span><span class="s4">.</span><span class="s6">id</span><span class="s4">, </span><span class="s6">f</span><span class="s4">.</span><span class="s6">acres</span><span class="s4">])),</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">notes</span><span class="s4">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">timestamp:</span><span class="s4"> </span><span class="s1">serverTimestamp</span><span class="s4">()</span></p>
<p class="p6"><span class="s1">};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p4"><span class="s6">console</span><span class="s4">.</span><span class="s10">log</span><span class="s4">(</span><span class="s1">'📦 Saving master job:'</span><span class="s4">, </span><span class="s8">masterJob</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">await</span><span class="s4"> </span><span class="s10">setDoc</span><span class="s4">(</span><span class="s10">doc</span><span class="s4">(</span><span class="s8">db</span><span class="s4">, </span><span class="s5">'jobs'</span><span class="s4">, </span><span class="s8">jobId</span><span class="s4">), </span><span class="s8">masterJob</span><span class="s4">); </span><span class="s1">// ← final and only call to save job</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">isEditing</span><span class="s4">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">q</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s10">query</span><span class="s4">(</span><span class="s10">collection</span><span class="s4">(</span><span class="s8">db</span><span class="s4">, </span><span class="s1">'jobsByField'</span><span class="s4">), </span><span class="s10">where</span><span class="s4">(</span><span class="s1">'linkedToJobId'</span><span class="s4">, </span><span class="s1">'=='</span><span class="s4">, </span><span class="s8">jobId</span><span class="s4">));</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">existing</span><span class="s1"> </span><span class="s9">=</span><span class="s1"> </span><span class="s3">await</span><span class="s1"> </span><span class="s10">getDocs</span><span class="s1">(</span><span class="s8">q</span><span class="s1">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">await</span><span class="s1"> </span><span class="s12">Promise</span><span class="s1">.</span><span class="s10">all</span><span class="s1">(</span><span class="s8">existing</span><span class="s1">.</span><span class="s6">docs</span><span class="s1">.</span><span class="s10">map</span><span class="s1">(</span><span class="s6">docSnap</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s10">deleteDoc</span><span class="s1">(</span><span class="s10">doc</span><span class="s1">(</span><span class="s8">db</span><span class="s1">, </span><span class="s5">'jobsByField'</span><span class="s1">, </span><span class="s6">docSnap</span><span class="s1">.</span><span class="s6">id</span><span class="s1">))));</span></p>
<p class="p6"><span class="s1">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">jobsByFieldPromises</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">updatedFieldsWithAcres</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s6">field</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> {</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">   </span></span><span class="s7">const</span><span class="s4"> </span><span class="s1">jobEntry</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">jobId</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">linkedToJobId:</span><span class="s4"> </span><span class="s8">jobId</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">fieldId:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">id</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">fieldName:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">fieldName</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">cropYear</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">crop:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">crops</span><span class="s4">?.[</span><span class="s8">cropYear</span><span class="s4">]?.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">acres:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">acres</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">drawnAcres:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">drawnAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">drawnPolygon:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">drawnPolygon</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span><span class="s4">,</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">status:</span><span class="s4"> </span><span class="s8">jobStatus</span><span class="s4">, </span><span class="s1">// ✅ this line</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">vendor:</span><span class="s4"> </span><span class="s8">vendor</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">applicator:</span><span class="s4"> </span><span class="s8">applicator</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">...</span></p>
<p class="p6"><span class="s1">(() </span><span class="s7">=&gt;</span><span class="s1"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">crop</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">crops</span><span class="s4">?.[</span><span class="s8">cropYear</span><span class="s4">]?.</span><span class="s1">crop</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s8">crop</span><span class="s1">.</span><span class="s10">includes</span><span class="s1">(</span><span class="s5">'Rice'</span><span class="s1">)) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">return</span><span class="s4"> { </span><span class="s1">riceLeveeAcres:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">riceLeveeAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span><span class="s4"> };</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s8">crop</span><span class="s1">.</span><span class="s10">includes</span><span class="s1">(</span><span class="s5">'Soybean'</span><span class="s1">)) {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">return</span><span class="s4"> { </span><span class="s1">beanLeveeAcres:</span><span class="s4"> </span><span class="s1">field</span><span class="s4">.</span><span class="s1">beanLeveeAcres</span><span class="s4"> </span><span class="s9">??</span><span class="s4"> </span><span class="s7">null</span><span class="s4"> };</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">return</span><span class="s1"> {};</span></p>
<p class="p6"><span class="s1">})(),</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">     </span></span><span class="s1">jobType:</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">name:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">.</span><span class="s1">name</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">icon:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">.</span><span class="s1">icon</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">cost:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">.</span><span class="s1">cost</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s11">0</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">parentName:</span><span class="s4"> </span><span class="s8">jobType</span><span class="s4">.</span><span class="s1">parentName</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span></p>
<p class="p6"><span class="s1">},</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s9">...</span><span class="s1">(</span><span class="s8">jobType</span><span class="s1">?.</span><span class="s6">parentName</span><span class="s1"> </span><span class="s9">===</span><span class="s1"> </span><span class="s5">'Tillage'</span><span class="s1"> </span><span class="s9">?</span><span class="s1"> { </span><span class="s6">passes:</span><span class="s1"> </span><span class="s10">parseInt</span><span class="s1">(</span><span class="s8">passes</span><span class="s1">) </span><span class="s9">||</span><span class="s1"> </span><span class="s11">1</span><span class="s1"> } </span><span class="s9">:</span><span class="s1"> {}),</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s1">// 👈 here</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s6">jobDate:</span><span class="s1"> </span><span class="s8">jobDate</span><span class="s1"> </span><span class="s9">||</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s1">().</span><span class="s10">toISOString</span><span class="s1">().</span><span class="s10">split</span><span class="s1">(</span><span class="s5">'T'</span><span class="s1">)[</span><span class="s11">0</span><span class="s1">],</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s6">notes</span><span class="s1">,</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s6">products:</span><span class="s4"> </span><span class="s1">cleanedProducts</span><span class="s4">,</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s6">waterVolume:</span><span class="s4"> </span><span class="s1">requiresWater</span><span class="s4"> </span><span class="s9">?</span><span class="s4"> </span><span class="s1">waterVolume</span><span class="s4"> </span><span class="s9">:</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s6">timestamp:</span><span class="s4"> </span><span class="s1">serverTimestamp</span><span class="s4">()</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p4"><span class="s6">console</span><span class="s4">.</span><span class="s10">log</span><span class="s4">(</span><span class="s1">'💾 jobEntry:'</span><span class="s4">, </span><span class="s8">jobEntry</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">return</span><span class="s1"> </span><span class="s10">setDoc</span><span class="s1">(</span><span class="s10">doc</span><span class="s1">(</span><span class="s8">db</span><span class="s1">, </span><span class="s5">'jobsByField'</span><span class="s1">, </span><span class="s5">`</span><span class="s7">${</span><span class="s8">jobId</span><span class="s7">}</span><span class="s5">_</span><span class="s7">${</span><span class="s6">field</span><span class="s9">.</span><span class="s6">id</span><span class="s7">}</span><span class="s5">`</span><span class="s1">), </span><span class="s8">jobEntry</span><span class="s1">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">await</span><span class="s4"> </span><span class="s12">Promise</span><span class="s4">.</span><span class="s10">all</span><span class="s4">(</span><span class="s1">jobsByFieldPromises</span><span class="s4">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s7">const</span><span class="s4"> </span><span class="s1">jobObj</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s9">...</span><span class="s1">masterJob</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">operator:</span><span class="s4"> </span><span class="s1">updatedFieldsWithAcres</span><span class="s4">[</span><span class="s11">0</span><span class="s4">]?.</span><span class="s1">operator</span><span class="s4"> </span><span class="s9">||</span><span class="s4"> </span><span class="s5">''</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">fields:</span><span class="s4"> </span><span class="s1">updatedFieldsWithAcres</span><span class="s4">,</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">acres:</span><span class="s4"> </span><span class="s1">Object</span><span class="s4">.</span><span class="s10">fromEntries</span><span class="s4">(</span><span class="s1">updatedFieldsWithAcres</span><span class="s4">.</span><span class="s10">map</span><span class="s4">(</span><span class="s1">f</span><span class="s4"> </span><span class="s7">=&gt;</span><span class="s4"> [</span><span class="s1">f</span><span class="s4">.</span><span class="s1">id</span><span class="s4">, </span><span class="s1">f</span><span class="s4">.</span><span class="s1">acres</span><span class="s4">]))</span></p>
<p class="p6"><span class="s1">};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s4"> (</span><span class="s1">shouldGeneratePDF</span><span class="s4">) {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">try</span><span class="s1"> {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> { </span><span class="s8">generatePDFBlob</span><span class="s4"> } </span><span class="s9">=</span><span class="s4"> </span><span class="s3">await</span><span class="s4"> </span><span class="s7">import</span><span class="s4">(</span><span class="s1">'../utils/generatePDF'</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">blob</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s3">await</span><span class="s4"> </span><span class="s1">generatePDFBlob</span><span class="s4">(</span><span class="s6">jobObj</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">url</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s8">URL</span><span class="s4">.</span><span class="s1">createObjectURL</span><span class="s4">(</span><span class="s6">blob</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> </span><span class="s8">link</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s6">document</span><span class="s4">.</span><span class="s1">createElement</span><span class="s4">(</span><span class="s5">'a'</span><span class="s4">);</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">link</span><span class="s4">.</span><span class="s1">href</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s1">url</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">link</span><span class="s4">.</span><span class="s1">download</span><span class="s4"> </span><span class="s9">=</span><span class="s4"> </span><span class="s5">`JobOrder_</span><span class="s7">${</span><span class="s1">jobType</span><span class="s7">}</span><span class="s5">_</span><span class="s7">${</span><span class="s1">cropYear</span><span class="s7">}</span><span class="s5">.pdf`</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">document</span><span class="s4">.</span><span class="s1">body</span><span class="s4">.</span><span class="s10">appendChild</span><span class="s4">(</span><span class="s1">link</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">link</span><span class="s1">.</span><span class="s10">click</span><span class="s1">();</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">document</span><span class="s4">.</span><span class="s1">body</span><span class="s4">.</span><span class="s10">removeChild</span><span class="s4">(</span><span class="s1">link</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">catch</span><span class="s1"> (</span><span class="s6">err</span><span class="s1">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s10">alert</span><span class="s4">(</span><span class="s1">'Job saved, but PDF failed to generate.'</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p6"><span class="s1">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">navigate</span><span class="s4">(</span><span class="s5">'/jobs'</span><span class="s4">);</span></p>
<p class="p6"><span class="s1">} </span><span class="s3">catch</span><span class="s1"> (</span><span class="s6">error</span><span class="s1">) {</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">console</span><span class="s4">.</span><span class="s10">error</span><span class="s4">(</span><span class="s1">'🔥 SAVE ERROR:'</span><span class="s4">, </span><span class="s6">error</span><span class="s4">);</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s10">alert</span><span class="s4">(</span><span class="s1">'Failed to save job.'</span><span class="s4">);</span></p>
<p class="p6"><span class="s1">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s1">finally</span><span class="s4"> {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">setSaving</span><span class="s4">(</span><span class="s7">false</span><span class="s4">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p6"><span class="s1">};</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s3">if</span><span class="s4"> (</span><span class="s9">!</span><span class="s1">jobTypesList</span><span class="s4">.</span><span class="s1">length</span><span class="s4">) </span><span class="s3">return</span><span class="s4"> </span><span class="s7">null</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p5"><span class="s1">return</span><span class="s4"> (</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s4"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"p-6"</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">     </span></span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s7">{</span><span class="s1">/* Inputs and product selectors */</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s4"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"mb-4"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s4">Job Type</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">       </span></span><span class="s7">{</span><span class="s1">jobTypesList</span><span class="s9">.</span><span class="s1">length</span><span class="s9"> &gt; </span><span class="s11">0</span><span class="s9"> &amp;&amp; (</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space"> </span></span><span class="s13">&lt;</span><span class="s1">select</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">jobType</span><span class="s9">?.</span><span class="s1">name</span><span class="s9"> || </span><span class="s5">''</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s1">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">selected</span><span class="s9"> = </span><span class="s1">jobTypesList</span><span class="s9">.</span><span class="s10">find</span><span class="s9">(</span><span class="s1">t</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s1">t</span><span class="s9">.</span><span class="s1">name</span><span class="s9"> === </span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s10">setJobType</span><span class="s1">(</span><span class="s6">selected</span><span class="s1"> || </span><span class="s5">''</span><span class="s1">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>}</span><span class="s7">}</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 bg-white w-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span></p>
<p class="p11"><span class="s1">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s1"> </span><span class="s6">value</span><span class="s1">=</span><span class="s5">""</span><span class="s13">&gt;</span><span class="s1">Select Job Type</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">{</span><span class="s1">jobTypesList</span><span class="s9">.</span><span class="s10">map</span><span class="s9">(</span><span class="s1">type</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> (</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s9"> </span><span class="s1">key</span><span class="s9">=</span><span class="s7">{</span><span class="s1">type</span><span class="s9">.</span><span class="s1">name</span><span class="s7">}</span><span class="s9"> </span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">type</span><span class="s9">.</span><span class="s1">name</span><span class="s7">}</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s7">{</span><span class="s1">type</span><span class="s9">.</span><span class="s1">name</span><span class="s7">}</span><span class="s9"> </span><span class="s7">{</span><span class="s1">type</span><span class="s9">.</span><span class="s1">parentName</span><span class="s9"> ? </span><span class="s5">`(</span><span class="s7">${</span><span class="s1">type</span><span class="s9">.</span><span class="s1">parentName</span><span class="s7">}</span><span class="s5">)`</span><span class="s9"> : </span><span class="s5">''</span><span class="s7">}</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>))</span><span class="s7">}</span></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">select</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1">)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"grid grid-cols-2 gap-4 mb-4"</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s4">Job Date</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">input</span><span class="s4"> </span><span class="s6">type</span><span class="s9">=</span><span class="s1">"date"</span><span class="s4"> </span><span class="s6">value</span><span class="s9">=</span><span class="s7">{</span><span class="s6">jobDate</span><span class="s7">}</span><span class="s4"> </span><span class="s6">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s6">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setJobDate</span><span class="s9">(</span><span class="s6">e</span><span class="s9">.</span><span class="s6">target</span><span class="s9">.</span><span class="s6">value</span><span class="s9">)</span><span class="s7">}</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 bg-white w-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span><span class="s13">/&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s4">Vendor</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">select</span><span class="s4"> </span><span class="s6">value</span><span class="s9">=</span><span class="s7">{</span><span class="s6">vendor</span><span class="s7">}</span><span class="s4"> </span><span class="s6">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s6">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setVendor</span><span class="s9">(</span><span class="s6">e</span><span class="s9">.</span><span class="s6">target</span><span class="s9">.</span><span class="s6">value</span><span class="s9">)</span><span class="s7">}</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 bg-white w-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s1"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">""</span><span class="s13">&gt;</span><span class="s1">Select Vendor</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">{</span><span class="s6">vendors</span><span class="s9">.</span><span class="s10">map</span><span class="s9">(</span><span class="s6">v</span><span class="s9"> </span><span class="s1">=&gt;</span><span class="s9"> </span><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">key</span><span class="s9">=</span><span class="s1">{</span><span class="s6">v</span><span class="s1">}</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s1">{</span><span class="s6">v</span><span class="s1">}</span><span class="s13">&gt;</span><span class="s1">{</span><span class="s6">v</span><span class="s1">}</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span><span class="s9">)</span><span class="s1">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;/</span><span class="s7">select</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s4">Applicator</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s13">&lt;</span><span class="s7">select</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">applicator</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s1">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setApplicator</span><span class="s9">(</span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 bg-white w-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span></p>
<p class="p11"><span class="s1">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s1"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">""</span><span class="s13">&gt;</span><span class="s1">Select Applicator</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">{</span><span class="s1">applicators</span><span class="s9">.</span><span class="s10">map</span><span class="s9">(</span><span class="s1">a</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> (</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">key</span><span class="s9">=</span><span class="s1">{</span><span class="s6">a</span><span class="s1">}</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s1">{</span><span class="s6">a</span><span class="s1">}</span><span class="s13">&gt;</span><span class="s1">{</span><span class="s6">a</span><span class="s1">}</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>))</span><span class="s7">}</span></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">select</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s1"> </span><span class="s6">className</span><span class="s9">=</span><span class="s5">"mb-4"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s4">Job Status</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s1">select</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">jobStatus</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s9">(</span><span class="s1">e</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setJobStatus</span><span class="s9">(</span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 bg-white w-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s1"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"Planned"</span><span class="s13">&gt;</span><span class="s1">Planned</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s4"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"Completed"</span><span class="s13">&gt;</span><span class="s4">Completed</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;/</span><span class="s1">select</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">     </span></span><span class="s7">{</span><span class="s1">requiresProducts</span><span class="s9"> &amp;&amp; </span><span class="s1">editableProducts</span><span class="s9">.</span><span class="s10">map</span><span class="s9">((</span><span class="s1">p</span><span class="s9">, </span><span class="s1">i</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> (</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">div</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">key</span><span class="s9">=</span><span class="s7">{</span><span class="s1">i</span><span class="s7">}</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"grid grid-cols-1 sm:grid-cols-4 gap-2 mb-3 items-center"</span></p>
<p class="p11"><span class="s1">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p12"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">ProductComboBox</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">productType</span><span class="s9">=</span><span class="s7">{</span><span class="s1">selectedProductType</span><span class="s7">}</span></p>
<p class="p3"><span class="s1">allProducts</span><span class="s9">=</span><span class="s7">{</span><span class="s1">productsList</span><span class="s9">.</span><span class="s10">filter</span><span class="s9">(</span><span class="s1">p</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">parent</span><span class="s9"> = </span><span class="s1">jobType</span><span class="s9">?.</span><span class="s1">parentName</span><span class="s9">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s6">parent</span><span class="s1"> === </span><span class="s5">'Seeding'</span><span class="s1">) </span><span class="s3">return</span><span class="s1"> </span><span class="s6">p</span><span class="s1">.</span><span class="s6">type</span><span class="s1"> === </span><span class="s5">'Seed'</span><span class="s1">;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s9"> (</span><span class="s6">parent</span><span class="s9"> === </span><span class="s1">'Spraying'</span><span class="s9">) </span><span class="s3">return</span><span class="s9"> </span><span class="s6">p</span><span class="s9">.</span><span class="s6">type</span><span class="s9"> === </span><span class="s1">'Chemical'</span><span class="s9">;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s9"> (</span><span class="s6">parent</span><span class="s9"> === </span><span class="s1">'Fertilizer'</span><span class="s9">) </span><span class="s3">return</span><span class="s9"> </span><span class="s6">p</span><span class="s9">.</span><span class="s6">type</span><span class="s9"> === </span><span class="s1">'Fertilizer'</span><span class="s9">;</span></p>
<p class="p1"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s3">return</span><span class="s9"> </span><span class="s7">true</span><span class="s9">; </span><span class="s1">// fallback if no match</span></p>
<p class="p10"><span class="s1">})</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s1">usedProductIds</span><span class="s9">=</span><span class="s7">{</span><span class="s1">usedProductIds</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s9">{</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">id:</span><span class="s9"> </span><span class="s1">p</span><span class="s9">.</span><span class="s1">productId</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">name:</span><span class="s9"> </span><span class="s1">p</span><span class="s9">.</span><span class="s1">productName</span></p>
<p class="p10"><span class="s1">}</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s9">(</span><span class="s1">selected</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> {</span></p>
<p class="p7"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">handleProductChange</span><span class="s9">(</span><span class="s6">i</span><span class="s9">, </span><span class="s5">'productId'</span><span class="s9">, </span><span class="s6">selected</span><span class="s9">.</span><span class="s6">id</span><span class="s9">);</span></p>
<p class="p7"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">handleProductChange</span><span class="s9">(</span><span class="s6">i</span><span class="s9">, </span><span class="s5">'productName'</span><span class="s9">, </span><span class="s6">selected</span><span class="s9">.</span><span class="s6">name</span><span class="s9">);</span></p>
<p class="p7"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">handleProductChange</span><span class="s9">(</span><span class="s6">i</span><span class="s9">, </span><span class="s5">'crop'</span><span class="s9">, </span><span class="s6">selected</span><span class="s9">.</span><span class="s6">crop</span><span class="s9"> || </span><span class="s5">''</span><span class="s9">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">// ✅ Only set clean units based on rateType</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">rateType</span><span class="s9"> = </span><span class="s1">selected</span><span class="s9">?.</span><span class="s1">rateType</span><span class="s9">?.</span><span class="s10">toLowerCase</span><span class="s9">();</span></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s1">cleanUnit</span><span class="s9"> =</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">rateType</span><span class="s1"> === </span><span class="s5">'weight'</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span>? </span><span class="s1">'lbs/acre'</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span>: </span><span class="s6">rateType</span><span class="s1"> === </span><span class="s5">'population'</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span>? </span><span class="s1">'seeds/acre'</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span>: </span><span class="s6">selected</span><span class="s1">.</span><span class="s6">unit</span><span class="s1"> || </span><span class="s5">''</span><span class="s1">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p7"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">handleProductChange</span><span class="s9">(</span><span class="s6">i</span><span class="s9">, </span><span class="s5">'unit'</span><span class="s9">, </span><span class="s6">cleanUnit</span><span class="s9">);</span></p>
<p class="p7"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">handleProductChange</span><span class="s9">(</span><span class="s6">i</span><span class="s9">, </span><span class="s5">'rateType'</span><span class="s9">, </span><span class="s6">selected</span><span class="s9">.</span><span class="s6">rateType</span><span class="s9"> || </span><span class="s5">''</span><span class="s9">);</span></p>
<p class="p10"><span class="s1">}</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p11"><span class="s1">/&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">input</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s6">type</span><span class="s9">=</span><span class="s1">"number"</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">placeholder</span><span class="s9">=</span><span class="s5">"Rate"</span></p>
<p class="p4"><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 bg-white w-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">p</span><span class="s9">.</span><span class="s1">rate</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s1">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">handleProductChange</span><span class="s9">(</span><span class="s1">i</span><span class="s9">, </span><span class="s5">'rate'</span><span class="s9">, </span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">/&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">select</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border p-2 rounded w-full"</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">p</span><span class="s9">.</span><span class="s1">unit</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s9">(</span><span class="s1">e</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">handleProductChange</span><span class="s9">(</span><span class="s1">i</span><span class="s9">, </span><span class="s5">'unit'</span><span class="s9">, </span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p11"><span class="s1">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s1"> </span><span class="s6">value</span><span class="s1">=</span><span class="s5">""</span><span class="s13">&gt;</span><span class="s1">Select Unit</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">{</span><span class="s1">/* Include current product's unit if it's not already listed */</span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">{</span><span class="s1">![</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'oz/acre'</span><span class="s9">,</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'pt/acre'</span><span class="s9">,</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'qt/acre'</span><span class="s9">,</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'gal/acre'</span><span class="s9">,</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'lbs/acre'</span><span class="s9">,</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'seeds/acre'</span><span class="s9">,</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">'units/acre'</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>].</span><span class="s10">includes</span><span class="s1">(</span><span class="s6">p</span><span class="s1">.</span><span class="s6">unit</span><span class="s1">) &amp;&amp; </span><span class="s6">p</span><span class="s1">.</span><span class="s6">unit</span><span class="s1"> &amp;&amp; (</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s1">{</span><span class="s6">p</span><span class="s9">.</span><span class="s6">unit</span><span class="s1">}</span><span class="s13">&gt;</span><span class="s1">{</span><span class="s6">p</span><span class="s9">.</span><span class="s6">unit</span><span class="s1">}</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space"> </span></span><span class="s13">&lt;</span><span class="s7">option</span><span class="s1"> </span><span class="s6">value</span><span class="s1">=</span><span class="s5">"fl oz/acre"</span><span class="s13">&gt;</span><span class="s1">fl oz/acre</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"pt/acre"</span><span class="s13">&gt;</span><span class="s9">pt/acre</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"qt/acre"</span><span class="s13">&gt;</span><span class="s9">qt/acre</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"gal/acre"</span><span class="s13">&gt;</span><span class="s9">gal/acre</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"lbs/acre"</span><span class="s13">&gt;</span><span class="s9">lbs/acre</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p1"><span class="s13">&lt;</span><span class="s7">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"oz dry/acre"</span><span class="s13">&gt;</span><span class="s9">oz dry/acre</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span><span class="s9"> </span><span class="s7">{</span><span class="s1">/* 👈 for dry stuff like Sharpen */</span><span class="s7">}</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"tons/acre"</span><span class="s13">&gt;</span><span class="s9">tons/acre</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s13">&lt;</span><span class="s7">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s1">"seeds/acre"</span><span class="s13">&gt;</span><span class="s9">seeds/acre</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s13">&lt;</span><span class="s7">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s1">"units/acre"</span><span class="s13">&gt;</span><span class="s9">units/acre</span><span class="s13">&lt;/</span><span class="s7">option</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s13">&lt;</span><span class="s1">option</span><span class="s9"> </span><span class="s6">value</span><span class="s9">=</span><span class="s5">"%v/v"</span><span class="s13">&gt;</span><span class="s9">%V/V</span><span class="s13">&lt;/</span><span class="s1">option</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">select</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">   </span></span><span class="s13">&lt;</span><span class="s1">button</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">className</span><span class="s9">=</span><span class="s7">{</span><span class="s1">redLinkBtn</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s6">onClick</span><span class="s1">=</span><span class="s7">{</span><span class="s1">() </span><span class="s7">=&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">setEditableProducts</span><span class="s1">(</span><span class="s6">prev</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s6">prev</span><span class="s1">.</span><span class="s10">filter</span><span class="s1">((</span><span class="s6">_</span><span class="s1">, </span><span class="s6">idx</span><span class="s1">) </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s6">idx</span><span class="s1"> !== </span><span class="s6">i</span><span class="s1">))</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span>🗑️ Remove</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;/</span><span class="s1">button</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1">))</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s7">{</span><span class="s1">requiresProducts</span><span class="s9"> &amp;&amp; (</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s1">button</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">onClick</span><span class="s9">=</span><span class="s7">{</span><span class="s1">handleAddProduct</span><span class="s7">}</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"text-sm bg-blue-600 text-white px-3 py-1 rounded shadow hover:bg-blue-700 transition mb-4"</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span>+ Add Product</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;/</span><span class="s1">button</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1">)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s7">{</span><span class="s1">jobType</span><span class="s9">?.</span><span class="s1">parentName</span><span class="s9"> === </span><span class="s5">'Tillage'</span><span class="s9"> &amp;&amp; (</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s9"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"mb-4"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s9"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s9">Number of Passes</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">input</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s6">type</span><span class="s9">=</span><span class="s1">"number"</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s6">min</span><span class="s1">=</span><span class="s7">{</span><span class="s11">1</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">passes</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s9">(</span><span class="s1">e</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setPasses</span><span class="s9">(</span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-md px-3 py-2 w-32 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">/&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1">)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">{</span><span class="s1">jobType</span><span class="s9">?.</span><span class="s1">parentName</span><span class="s9"> === </span><span class="s5">'Spraying'</span><span class="s9"> &amp;&amp; (</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s9"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"mb-4"</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s1"> </span><span class="s6">className</span><span class="s1">=</span><span class="s5">"block text-sm font-medium"</span><span class="s13">&gt;</span><span class="s1">Water Volume (gal/acre)</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s1">input</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s6">type</span><span class="s9">=</span><span class="s1">"number"</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border rounded p-2 w-48"</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">waterVolume</span><span class="s7">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s1">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setWaterVolume</span><span class="s9">(</span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">/&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1">)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s13">&lt;</span><span class="s7">div</span><span class="s4"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"mb-6"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s13">&lt;</span><span class="s7">h3</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"text-lg font-semibold mb-2"</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>Fields (</span><span class="s7">{</span><span class="s6">fields</span><span class="s9">.</span><span class="s6">length</span><span class="s7">}</span><span class="s1">) – </span><span class="s7">{</span><span class="s6">totalJobAcres</span><span class="s9">.</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">2</span><span class="s9">)</span><span class="s7">}</span><span class="s1"> acres total</span></p>
<p class="p11"><span class="s1">&lt;/</span><span class="s7">h3</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s7">{</span><span class="s1">fields</span><span class="s9">.</span><span class="s10">map</span><span class="s9">((</span><span class="s1">field</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> {</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p1"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">// rest of your render logic</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">isPartial</span><span class="s9"> = </span><span class="s1">field</span><span class="s9">.</span><span class="s1">drawnPolygon</span><span class="s9"> &amp;&amp; </span><span class="s1">field</span><span class="s9">.</span><span class="s1">drawnAcres</span><span class="s9">;</span></p>
<p class="p3"><span class="s7">const</span><span class="s9"> </span><span class="s8">displayAcres</span><span class="s9"> = (</span><span class="s1">isPartial</span><span class="s9"> ? </span><span class="s1">field</span><span class="s9">.</span><span class="s1">drawnAcres</span><span class="s9"> : </span><span class="s1">field</span><span class="s9">.</span><span class="s1">gpsAcres</span><span class="s9">) ?? </span><span class="s11">0</span><span class="s9">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">crop</span><span class="s9"> = </span><span class="s1">field</span><span class="s9">.</span><span class="s1">crop</span><span class="s9"> || </span><span class="s1">field</span><span class="s9">.</span><span class="s1">crops</span><span class="s9">?.[</span><span class="s1">cropYear</span><span class="s9">]?.</span><span class="s1">crop</span><span class="s9"> || </span><span class="s5">'—'</span><span class="s9">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">let</span><span class="s9"> </span><span class="s1">parsedGeo</span><span class="s9"> = </span><span class="s1">field</span><span class="s9">.</span><span class="s1">boundary</span><span class="s9">?.</span><span class="s1">geojson</span><span class="s9">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s1"> (</span><span class="s7">typeof</span><span class="s1"> </span><span class="s6">parsedGeo</span><span class="s1"> === </span><span class="s5">'string'</span><span class="s1">) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">try</span><span class="s1"> {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s1">parsedGeo</span><span class="s9"> = </span><span class="s8">JSON</span><span class="s9">.</span><span class="s10">parse</span><span class="s9">(</span><span class="s1">parsedGeo</span><span class="s9">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s3">catch</span><span class="s1"> {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s6">parsedGeo</span><span class="s1"> = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p5"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">return</span><span class="s9"> (</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s9"> </span><span class="s6">key</span><span class="s9">=</span><span class="s7">{</span><span class="s6">field</span><span class="s9">.</span><span class="s6">id</span><span class="s7">}</span><span class="s9"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"border border-gray-300 rounded-xl bg-white p-4 shadow-sm mb-6"</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p11"><span class="s1">&lt;</span><span class="s7">p</span><span class="s1">&gt;</span></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s1">strong</span><span class="s13">&gt;</span><span class="s1">{</span><span class="s6">field</span><span class="s9">.</span><span class="s6">fieldName</span><span class="s1">}</span><span class="s13">&lt;/</span><span class="s1">strong</span><span class="s13">&gt;</span><span class="s9"> –</span><span class="s1">{</span><span class="s5">' '</span><span class="s1">}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">{</span><span class="s1">isLeveeJob</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span>? </span><span class="s5">`</span><span class="s7">${</span><span class="s9">((</span><span class="s1">field</span><span class="s9">.</span><span class="s1">crop</span><span class="s9"> || </span><span class="s1">field</span><span class="s9">.</span><span class="s1">crops</span><span class="s9">?.[</span><span class="s1">cropYear</span><span class="s9">]?.</span><span class="s1">crop</span><span class="s9"> || </span><span class="s5">''</span><span class="s9">).</span><span class="s10">includes</span><span class="s9">(</span><span class="s5">'Rice'</span><span class="s9">)</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">        </span>? </span><span class="s1">field</span><span class="s9">.</span><span class="s1">riceLeveeAcres</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">        </span>: </span><span class="s1">field</span><span class="s9">.</span><span class="s1">beanLeveeAcres</span><span class="s9">) || </span><span class="s11">0</span><span class="s7">}</span><span class="s5"> acres (Levee – </span><span class="s7">${</span><span class="s1">field</span><span class="s9">.</span><span class="s1">crop</span><span class="s9"> || </span><span class="s1">field</span><span class="s9">.</span><span class="s1">crops</span><span class="s9">?.[</span><span class="s1">cropYear</span><span class="s9">]?.</span><span class="s1">crop</span><span class="s9"> || </span><span class="s5">'—'</span><span class="s7">}</span><span class="s5">)`</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span>: </span><span class="s1">`</span><span class="s7">${</span><span class="s10">Number</span><span class="s9">(</span><span class="s6">displayAcres</span><span class="s9">).</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">2</span><span class="s9">)</span><span class="s7">}</span><span class="s1"> acres – </span><span class="s7">${</span><span class="s6">isPartial</span><span class="s9"> ? </span><span class="s1">'partial'</span><span class="s9"> : </span><span class="s1">'full'</span><span class="s7">}</span><span class="s1">`</span><span class="s7">}</span></p>
<p class="p11"><span class="s1">&lt;/</span><span class="s7">p</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">p</span><span class="s13">&gt;</span><span class="s1">Crop: </span><span class="s7">{</span><span class="s6">crop</span><span class="s7">}</span><span class="s13">&lt;/</span><span class="s7">p</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">     </span></span><span class="s13">&lt;</span><span class="s7">div</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s6">id</span><span class="s9">=</span><span class="s7">{</span><span class="s1">`field-canvas-</span><span class="s7">${</span><span class="s6">field</span><span class="s9">.</span><span class="s6">id</span><span class="s7">}</span><span class="s1">`</span><span class="s7">}</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"bg-white p-2 rounded border shadow-sm mt-4"</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s6">style</span><span class="s9">=</span><span class="s7">{</span><span class="s9">{ </span><span class="s6">width:</span><span class="s9"> </span><span class="s1">'fit-content'</span><span class="s9">, </span><span class="s6">margin:</span><span class="s9"> </span><span class="s1">'0 auto'</span><span class="s9"> }</span><span class="s7">}</span></p>
<p class="p11"><span class="s1">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s7">{</span><span class="s10">renderBoundarySVG</span><span class="s9">(</span><span class="s1">parsedGeo</span><span class="s9">, </span><span class="s1">field</span><span class="s9">.</span><span class="s1">drawnPolygon</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s9"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"flex justify-between items-center mt-2 no-print"</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">button</span></p>
<p class="p3"><span class="s1">className</span><span class="s9">=</span><span class="s7">{</span><span class="s1">blueLinkBtn</span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s6">onClick</span><span class="s1">=</span><span class="s7">{</span><span class="s1">() </span><span class="s7">=&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">       </span></span><span class="s10">navigate</span><span class="s9">(</span><span class="s1">`/jobs/edit-area/</span><span class="s7">${</span><span class="s6">field</span><span class="s9">.</span><span class="s6">id</span><span class="s7">}</span><span class="s1">`</span><span class="s9">, {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">state:</span><span class="s9"> {</span></p>
<p class="p1"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s6">field</span><span class="s9">, </span><span class="s1">// 👈 this line is required</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">selectedFields:</span><span class="s9"> </span><span class="s1">fields</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">drawnPolygon:</span><span class="s9"> </span><span class="s1">field</span><span class="s9">.</span><span class="s1">drawnPolygon</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">jobType</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">vendor</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">applicator</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">products:</span><span class="s9"> </span><span class="s1">editableProducts</span><span class="s9">,</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">cropYear</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p10"><span class="s1">})</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">          </span>✏️ Edit Area</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;/</span><span class="s7">button</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">button</span></p>
<p class="p3"><span class="s1">className</span><span class="s9">=</span><span class="s7">{</span><span class="s1">blueLinkBtn</span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s6">onClick</span><span class="s1">=</span><span class="s7">{</span><span class="s1">() </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s10">setFields</span><span class="s1">(</span><span class="s6">prev</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s6">prev</span><span class="s1">.</span><span class="s10">filter</span><span class="s1">(</span><span class="s6">f</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s6">f</span><span class="s1">.</span><span class="s6">id</span><span class="s1"> !== </span><span class="s6">field</span><span class="s1">.</span><span class="s6">id</span><span class="s1">))</span><span class="s7">}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">          </span>❌ Remove Field</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;/</span><span class="s7">button</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p10"><span class="s1">})</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s13">&lt;</span><span class="s7">div</span><span class="s4"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"mt-6"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"block text-sm font-medium mb-1"</span><span class="s13">&gt;</span><span class="s4">Notes</span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s1">textarea</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">value</span><span class="s9">=</span><span class="s7">{</span><span class="s1">notes</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s1">e</span><span class="s9"> </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setNotes</span><span class="s9">(</span><span class="s1">e</span><span class="s9">.</span><span class="s1">target</span><span class="s9">.</span><span class="s1">value</span><span class="s9">)</span><span class="s7">}</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s6">className</span><span class="s9">=</span><span class="s1">"w-full border border-gray-300 rounded-md p-2 text-sm resize-none"</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">rows</span><span class="s9">=</span><span class="s7">{</span><span class="s11">4</span><span class="s7">}</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s6">placeholder</span><span class="s9">=</span><span class="s1">"Add any notes for this job..."</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s13">/&gt;</span></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s7">{</span><span class="s1">requiresProducts</span><span class="s9"> &amp;&amp; (</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s9"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"mt-6 border-t pt-4"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">h4</span><span class="s9"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"font-semibold text-sm mb-2"</span><span class="s13">&gt;</span><span class="s9">Product Totals</span><span class="s13">&lt;/</span><span class="s7">h4</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s7">{</span><span class="s1">editableProducts</span><span class="s9">.</span><span class="s10">map</span><span class="s9">((</span><span class="s1">p</span><span class="s9">, </span><span class="s1">i</span><span class="s9">) </span><span class="s7">=&gt;</span><span class="s9"> {</span></p>
<p class="p7"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">rate</span><span class="s9"> = </span><span class="s1">parseFloat</span><span class="s9">(</span><span class="s6">p</span><span class="s9">.</span><span class="s6">rate</span><span class="s9">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">unit</span><span class="s1"> = </span><span class="s6">p</span><span class="s1">.</span><span class="s6">unit</span><span class="s1">?.</span><span class="s10">toLowerCase</span><span class="s1">() || </span><span class="s5">''</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">crop</span><span class="s1"> = </span><span class="s6">p</span><span class="s1">.</span><span class="s6">crop</span><span class="s1">?.</span><span class="s10">toLowerCase</span><span class="s1">?.() || </span><span class="s5">''</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">acres</span><span class="s1"> = </span><span class="s6">fields</span><span class="s1">.</span><span class="s10">reduce</span><span class="s1">((</span><span class="s6">sum</span><span class="s1">, </span><span class="s6">f</span><span class="s1">) </span><span class="s7">=&gt;</span><span class="s1"> {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s9"> (</span><span class="s1">isLeveeJob</span><span class="s9">) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">crop</span><span class="s1"> = </span><span class="s6">f</span><span class="s1">.</span><span class="s6">crop</span><span class="s1"> || </span><span class="s6">f</span><span class="s1">.</span><span class="s6">crops</span><span class="s1">?.[</span><span class="s6">cropYear</span><span class="s1">]?.</span><span class="s6">crop</span><span class="s1"> || </span><span class="s5">''</span><span class="s1">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s9"> (</span><span class="s1">crop</span><span class="s9">.</span><span class="s10">includes</span><span class="s9">(</span><span class="s5">'Rice'</span><span class="s9">) &amp;&amp; </span><span class="s1">f</span><span class="s9">.</span><span class="s1">riceLeveeAcres</span><span class="s9">) </span><span class="s3">return</span><span class="s9"> </span><span class="s1">sum</span><span class="s9"> + </span><span class="s10">parseFloat</span><span class="s9">(</span><span class="s1">f</span><span class="s9">.</span><span class="s1">riceLeveeAcres</span><span class="s9">);</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s3">if</span><span class="s9"> (</span><span class="s1">crop</span><span class="s9">.</span><span class="s10">includes</span><span class="s9">(</span><span class="s5">'Soybean'</span><span class="s9">) &amp;&amp; </span><span class="s1">f</span><span class="s9">.</span><span class="s1">beanLeveeAcres</span><span class="s9">) </span><span class="s3">return</span><span class="s9"> </span><span class="s1">sum</span><span class="s9"> + </span><span class="s10">parseFloat</span><span class="s9">(</span><span class="s1">f</span><span class="s9">.</span><span class="s1">beanLeveeAcres</span><span class="s9">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s3">return</span><span class="s9"> </span><span class="s1">sum</span><span class="s9"> + (</span><span class="s1">f</span><span class="s9">.</span><span class="s1">drawnAcres</span><span class="s9"> ?? </span><span class="s1">f</span><span class="s9">.</span><span class="s1">gpsAcres</span><span class="s9"> ?? </span><span class="s11">0</span><span class="s9">);</span></p>
<p class="p10"><span class="s1">}, </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p9"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s9"> </span><span class="s1">totalAmount</span><span class="s9"> = </span><span class="s6">rate</span><span class="s9"> * </span><span class="s6">acres</span><span class="s9">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s7">let</span><span class="s9"> </span><span class="s1">display</span><span class="s9"> = </span><span class="s5">''</span><span class="s9">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s3">if</span><span class="s9"> ([</span><span class="s1">'seeds/acre'</span><span class="s9">, </span><span class="s1">'population'</span><span class="s9">].</span><span class="s10">includes</span><span class="s9">(</span><span class="s6">unit</span><span class="s9">)) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">seedsPerUnit</span><span class="s1"> = </span><span class="s6">crop</span><span class="s1">.</span><span class="s10">includes</span><span class="s1">(</span><span class="s5">'rice'</span><span class="s1">) ? </span><span class="s11">900000</span><span class="s1"> : </span><span class="s6">crop</span><span class="s1">.</span><span class="s10">includes</span><span class="s1">(</span><span class="s5">'soybean'</span><span class="s1">) ? </span><span class="s11">140000</span><span class="s1"> : </span><span class="s11">1000000</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">totalSeeds</span><span class="s1"> = </span><span class="s6">rate</span><span class="s1"> * </span><span class="s6">acres</span><span class="s1">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">units</span><span class="s9"> = </span><span class="s1">totalSeeds</span><span class="s9"> / </span><span class="s1">seedsPerUnit</span><span class="s9">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">display</span><span class="s9"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s1">units</span><span class="s9">.</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">1</span><span class="s9">)</span><span class="s7">}</span><span class="s5"> units (</span><span class="s7">${</span><span class="s1">seedsPerUnit</span><span class="s9">.</span><span class="s10">toLocaleString</span><span class="s9">()</span><span class="s7">}</span><span class="s5"> seeds/unit)`</span><span class="s9">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s1"> </span><span class="s3">if</span><span class="s1"> ([</span><span class="s5">'lbs/acre'</span><span class="s1">].</span><span class="s10">includes</span><span class="s1">(</span><span class="s6">unit</span><span class="s1">)) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">lbsPerBushel</span><span class="s1"> = </span><span class="s6">crop</span><span class="s1">.</span><span class="s10">includes</span><span class="s1">(</span><span class="s5">'rice'</span><span class="s1">) ? </span><span class="s11">45</span><span class="s1"> : </span><span class="s6">crop</span><span class="s1">.</span><span class="s10">includes</span><span class="s1">(</span><span class="s5">'soybean'</span><span class="s1">) ? </span><span class="s11">60</span><span class="s1"> : </span><span class="s11">50</span><span class="s1">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s9"> </span><span class="s8">bushels</span><span class="s9"> = </span><span class="s1">totalAmount</span><span class="s9"> / </span><span class="s1">lbsPerBushel</span><span class="s9">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">display</span><span class="s9"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s1">bushels</span><span class="s9">.</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">1</span><span class="s9">)</span><span class="s7">}</span><span class="s5"> bushels`</span><span class="s9">;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s9"> </span><span class="s3">if</span><span class="s9"> ([</span><span class="s1">'fl oz/acre'</span><span class="s9">, </span><span class="s1">'oz/acre'</span><span class="s9">].</span><span class="s10">includes</span><span class="s9">(</span><span class="s6">unit</span><span class="s9">)) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">gal</span><span class="s1"> = </span><span class="s6">totalAmount</span><span class="s1"> / </span><span class="s11">128</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">display</span><span class="s1"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s6">gal</span><span class="s1">.</span><span class="s10">toFixed</span><span class="s1">(</span><span class="s11">2</span><span class="s1">)</span><span class="s7">}</span><span class="s5"> gallons`</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s1"> </span><span class="s3">if</span><span class="s1"> (</span><span class="s6">unit</span><span class="s1"> === </span><span class="s5">'pt/acre'</span><span class="s1">) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">gal</span><span class="s1"> = </span><span class="s6">totalAmount</span><span class="s1"> / </span><span class="s11">8</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">display</span><span class="s1"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s6">gal</span><span class="s1">.</span><span class="s10">toFixed</span><span class="s1">(</span><span class="s11">2</span><span class="s1">)</span><span class="s7">}</span><span class="s5"> gallons`</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s1"> </span><span class="s3">if</span><span class="s1"> (</span><span class="s6">unit</span><span class="s1"> === </span><span class="s5">'qt/acre'</span><span class="s1">) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">gal</span><span class="s1"> = </span><span class="s6">totalAmount</span><span class="s1"> / </span><span class="s11">4</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">display</span><span class="s1"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s6">gal</span><span class="s1">.</span><span class="s10">toFixed</span><span class="s1">(</span><span class="s11">2</span><span class="s1">)</span><span class="s7">}</span><span class="s5"> gallons`</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s1"> </span><span class="s3">if</span><span class="s1"> (</span><span class="s6">unit</span><span class="s1"> === </span><span class="s5">'oz dry/acre'</span><span class="s1">) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">lbs</span><span class="s1"> = </span><span class="s6">totalAmount</span><span class="s1"> / </span><span class="s11">16</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s6">display</span><span class="s1"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s6">lbs</span><span class="s1">.</span><span class="s10">toFixed</span><span class="s1">(</span><span class="s11">2</span><span class="s1">)</span><span class="s7">}</span><span class="s5"> lbs`</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s3">else</span><span class="s1"> </span><span class="s3">if</span><span class="s1"> (</span><span class="s6">unit</span><span class="s1"> === </span><span class="s5">'%v/v'</span><span class="s1">) {</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">water</span><span class="s1"> = </span><span class="s10">parseFloat</span><span class="s1">(</span><span class="s6">waterVolume</span><span class="s1"> || </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">gal</span><span class="s1"> = (</span><span class="s6">rate</span><span class="s1"> / </span><span class="s11">100</span><span class="s1">) * </span><span class="s6">water</span><span class="s1"> * </span><span class="s6">acres</span><span class="s1">;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">display</span><span class="s9"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s1">gal</span><span class="s9">.</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">2</span><span class="s9">)</span><span class="s7">}</span><span class="s5"> gallons`</span><span class="s9">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s1"> </span><span class="s3">if</span><span class="s1"> (</span><span class="s6">unit</span><span class="s1"> === </span><span class="s5">'tons/acre'</span><span class="s1">) {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">display</span><span class="s9"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s1">totalAmount</span><span class="s9">.</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">2</span><span class="s9">)</span><span class="s7">}</span><span class="s5"> tons`</span><span class="s9">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>} </span><span class="s3">else</span><span class="s1"> {</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s1">display</span><span class="s9"> = </span><span class="s5">`</span><span class="s7">${</span><span class="s1">totalAmount</span><span class="s9">.</span><span class="s10">toFixed</span><span class="s9">(</span><span class="s11">1</span><span class="s9">)</span><span class="s7">}</span><span class="s5"> </span><span class="s7">${</span><span class="s1">unit</span><span class="s9">.</span><span class="s10">replace</span><span class="s9">(</span><span class="s5">'/acre'</span><span class="s9">, </span><span class="s5">''</span><span class="s9">).</span><span class="s10">trim</span><span class="s9">()</span><span class="s7">}</span><span class="s5">`</span><span class="s9">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p5"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s1">return</span><span class="s9"> (</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s9"> </span><span class="s6">key</span><span class="s9">=</span><span class="s7">{</span><span class="s6">i</span><span class="s7">}</span><span class="s9"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"text-sm text-gray-700"</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">      </span></span><span class="s7">{</span><span class="s1">p</span><span class="s9">.</span><span class="s1">productName</span><span class="s9"> || </span><span class="s1">p</span><span class="s9">.</span><span class="s1">name</span><span class="s9"> || </span><span class="s5">'Unnamed'</span><span class="s7">}</span><span class="s9"> → </span><span class="s13">&lt;</span><span class="s7">span</span><span class="s9"> </span><span class="s1">className</span><span class="s9">=</span><span class="s5">"font-mono"</span><span class="s13">&gt;</span><span class="s7">{</span><span class="s1">display</span><span class="s7">}</span><span class="s13">&lt;/</span><span class="s7">span</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p10"><span class="s1">})</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s9"><span class="Apple-converted-space">  </span></span><span class="s13">&lt;/</span><span class="s1">div</span><span class="s13">&gt;</span></p>
<p class="p10"><span class="s1">)</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;</span><span class="s7">div</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"flex justify-between items-center"</span><span class="s13">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">label</span><span class="s4"> </span><span class="s6">className</span><span class="s9">=</span><span class="s1">"flex items-center gap-2"</span><span class="s13">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">input</span><span class="s4"> </span><span class="s1">type</span><span class="s9">=</span><span class="s5">"checkbox"</span><span class="s4"> </span><span class="s1">checked</span><span class="s9">=</span><span class="s7">{</span><span class="s1">shouldGeneratePDF</span><span class="s7">}</span><span class="s4"> </span><span class="s1">onChange</span><span class="s9">=</span><span class="s7">{</span><span class="s9">() </span><span class="s7">=&gt;</span><span class="s9"> </span><span class="s10">setShouldGeneratePDF</span><span class="s9">(!</span><span class="s1">shouldGeneratePDF</span><span class="s9">)</span><span class="s7">}</span><span class="s4"> </span><span class="s13">/&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">          </span></span><span class="s13">&lt;</span><span class="s7">span</span><span class="s13">&gt;</span><span class="s1">Generate PDF after saving</span><span class="s13">&lt;/</span><span class="s7">span</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;/</span><span class="s7">label</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s13">&lt;</span><span class="s7">button</span></p>
<p class="p3"><span class="s1">className</span><span class="s9">=</span><span class="s7">{</span><span class="s1">primaryBtn</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">onClick</span><span class="s9">=</span><span class="s7">{</span><span class="s1">handleSaveJob</span><span class="s7">}</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s1">disabled</span><span class="s9">=</span><span class="s7">{</span><span class="s1">saving</span><span class="s7">}</span></p>
<p class="p11"><span class="s1">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space"> </span></span><span class="s7">{</span><span class="s1">saving</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">  </span>? </span><span class="s1">'Saving...'</span></p>
<p class="p3"><span class="s9"><span class="Apple-converted-space">  </span>: </span><span class="s1">isEditing</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span>? </span><span class="s1">'Update Job'</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">    </span>: </span><span class="s1">'Save Final Job'</span><span class="s7">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p8"><span class="s13">&lt;/</span><span class="s1">button</span><span class="s13">&gt;</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">      </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s13">&lt;/</span><span class="s7">div</span><span class="s13">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">  </span>);</span></p>
<p class="p6"><span class="s1">}</span></p>
<p class="p2"><span class="s2"></span><br></p>
<p class="p3"><span class="s3">export</span><span class="s4"> </span><span class="s3">default</span><span class="s4"> </span><span class="s1">JobSummaryPage</span><span class="s4">;</span></p>
<p class="p2"><span class="s2"></span><br></p>
</body>
</html>
